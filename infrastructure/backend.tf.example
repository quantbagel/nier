# Nier Factory Floor Analytics Platform - Backend Configuration
# Copy this file to backend.tf and configure for your environment

terraform {
  backend "s3" {
    # S3 bucket for storing Terraform state
    bucket = "nier-terraform-state-ACCOUNT_ID"

    # State file path - update for each environment
    key = "nier/ENV/terraform.tfstate"

    # AWS region for the S3 bucket
    region = "us-west-2"

    # Enable state file encryption
    encrypt = true

    # DynamoDB table for state locking
    dynamodb_table = "nier-terraform-locks"

    # Enable workspace key prefix (optional)
    # workspace_key_prefix = "nier"
  }
}

# To set up the backend infrastructure, run:
# 1. Create S3 bucket:
#    aws s3api create-bucket --bucket nier-terraform-state-ACCOUNT_ID \
#      --region us-west-2 \
#      --create-bucket-configuration LocationConstraint=us-west-2
#
# 2. Enable versioning:
#    aws s3api put-bucket-versioning --bucket nier-terraform-state-ACCOUNT_ID \
#      --versioning-configuration Status=Enabled
#
# 3. Enable encryption:
#    aws s3api put-bucket-encryption --bucket nier-terraform-state-ACCOUNT_ID \
#      --server-side-encryption-configuration '{"Rules":[{"ApplyServerSideEncryptionByDefault":{"SSEAlgorithm":"aws:kms"}}]}'
#
# 4. Block public access:
#    aws s3api put-public-access-block --bucket nier-terraform-state-ACCOUNT_ID \
#      --public-access-block-configuration 'BlockPublicAcls=true,IgnorePublicAcls=true,BlockPublicPolicy=true,RestrictPublicBuckets=true'
#
# 5. Create DynamoDB table:
#    aws dynamodb create-table --table-name nier-terraform-locks \
#      --attribute-definitions AttributeName=LockID,AttributeType=S \
#      --key-schema AttributeName=LockID,KeyType=HASH \
#      --billing-mode PAY_PER_REQUEST \
#      --region us-west-2
