# Default values for nier-storage
# This is a YAML-formatted file.

replicaCount: 2

image:
  repository: nier/storage
  pullPolicy: IfNotPresent
  tag: "latest"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# Service Account configuration with IRSA for S3 access
serviceAccount:
  create: true
  automount: true
  annotations: {}
    # eks.amazonaws.com/role-arn: arn:aws:iam::ACCOUNT_ID:role/nier-storage-s3-role
  name: ""

# Pod annotations and labels
podAnnotations: {}
podLabels: {}

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true

# Service configuration
service:
  type: ClusterIP
  port: 8080
  targetPort: 8080
  annotations: {}

# Resource limits and requests
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 250m
    memory: 256Mi

# Horizontal Pod Autoscaler configuration
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 8
  targetCPUUtilizationPercentage: 70
  # targetMemoryUtilizationPercentage: 80

# Liveness and readiness probes
livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 10
  periodSeconds: 15
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /ready
    port: http
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

# Node selection and tolerations
nodeSelector: {}
tolerations: []
affinity: {}

# Pod Disruption Budget
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# S3 Configuration
s3:
  bucket: "nier-frames"
  region: "us-east-1"
  # Optional: endpoint for S3-compatible storage (e.g., MinIO)
  endpoint: ""
  # Path prefix for stored frames
  pathPrefix: "frames"
  # Presigned URL expiration in seconds
  presignedUrlExpiry: 3600

# Kafka Configuration
kafka:
  brokers: "kafka:9092"
  consumerGroup: "nier-storage"
  topic: "frame-metadata"
  # Additional Kafka settings
  sessionTimeout: 30000
  heartbeatInterval: 10000

# PostgreSQL/Database Configuration
database:
  # Connection URL (use secret reference in production)
  url: ""
  # Use existing secret for database URL
  existingSecret: ""
  existingSecretKey: "DATABASE_URL"
  # Connection pool settings
  maxConnections: 10
  minConnections: 2

# Storage service specific configuration
storage:
  # Sample rate for random frame storage (0.0 to 1.0)
  sampleRate: "0.01"
  # Always store frames with detections
  storeDetections: true
  # Batch size for processing
  batchSize: 100
  # Worker threads
  workerThreads: 4

# Environment variables from ConfigMap
configMap:
  enabled: true

# Additional environment variables
extraEnv: []
  # - name: RUST_LOG
  #   value: "info"

# Additional environment variables from secrets
extraEnvFrom: []
  # - secretRef:
  #     name: my-secret

# Additional volumes
extraVolumes: []

# Additional volume mounts
extraVolumeMounts: []
